# v0.4.0 Implementation Plan
## Polish & Organization - Production-Ready Features

**Version:** 0.4.0
**Target:** Features required for v1.0 App Store launch
**Timeline:** TBD
**Branch:** `feature/v0.4.0`

---

## Overview

v0.4.0 focuses on the essential organizational features and polish needed to make Mac MD production-ready for its v1.0 App Store launch. This version defers advanced editing features (Snippets, Editor Intelligence, LaTeX) to v2.0, prioritizing user-facing completeness over technical sophistication.

### Philosophy
- **Ship it, then improve it** - Get a solid 1.0 out the door
- **User feedback drives v2.0** - Real usage will inform advanced feature priorities
- **Foundation before features** - Polish the core experience before adding bells and whistles

---

## Feature Categories

### 1. Organizational Features
Multi-selection and bulk operations for power users with large document collections.

### 2. First Launch Experience
Onboarding splash screen to guide new users through the three-column layout.

### 3. Settings/Preferences Screen
User customization for fonts, export locations, and CloudKit sync status.

### 4. App Icon & Branding
Professional branding assets for all platforms (macOS, iOS, iPadOS).

### 5. Quality Assurance
CloudKit sync verification, cross-platform testing, and performance validation.

---

## Detailed Implementation

## 1. Organizational Features

### 1.1 Multi-Select Documents

**Goal:** Allow users to select multiple documents using Cmd-Click (Mac) or Ctrl-Click (iOS).

**UI Changes:**
- **DocumentListView.swift**:
  - Add `@State private var selectedDocumentIDs: Set<PersistentIdentifier> = []`
  - Modify List to support selection tracking
  - Add visual indicator (checkmark or highlight) for selected documents
  - Handle Cmd/Ctrl-Click modifier detection

**Platform Considerations:**
- macOS: Cmd-Click for multi-select
- iOS/iPadOS: Long-press to enter selection mode, then tap to select

**Files to Modify:**
- `Views/Main/DocumentListView.swift` - Add selection state and UI
- `Views/Components/DocumentRow.swift` (create if needed) - Row view with selection indicator

---

### 1.2 Bulk Operations

**Goal:** Enable bulk delete, tag, and move-to-project operations on selected documents.

**Operations:**
1. **Bulk Delete**
   - Context menu or toolbar button: "Delete Selected Documents"
   - Confirmation dialog: "Delete X documents?"
   - Delete all selected documents from SwiftData

2. **Bulk Tag**
   - Context menu or toolbar button: "Add Tag to Selected..."
   - Sheet with tag picker
   - Apply selected tag to all selected documents

3. **Bulk Move to Project**
   - Context menu or toolbar button: "Move Selected to Project..."
   - Sheet with project picker
   - Move all selected documents to chosen project

**UI Components:**
- Toolbar buttons appear when documents are selected
- Context menu on selected documents
- Confirmation dialogs for destructive operations

**Files to Create:**
- `Views/Components/BulkOperationsToolbar.swift` - Toolbar for bulk actions
- `Views/Components/TagPickerSheet.swift` - Tag selection for bulk operations
- `Views/Components/ProjectPickerSheet.swift` - Project selection for bulk moves

**Files to Modify:**
- `Views/Main/DocumentListView.swift` - Add bulk operation UI
- `Models/Document.swift` - Add batch operation helper methods if needed

---

### 1.3 Bulk Tag Application from Context Menu

**Goal:** Quick tag application via context menu on selected documents.

**Implementation:**
- Context menu shows "Add Tag" submenu
- Lists all available tags
- Tapping a tag adds it to all selected documents
- Already-applied tags shown with checkmark

**Files to Modify:**
- `Views/Main/DocumentListView.swift` - Add context menu with tag submenu

---

## 2. First Launch Experience

### 2.1 Splash Screen

**Goal:** Show a welcome screen on first launch only, explaining the three-column layout.

**Implementation:**
- Use `@AppStorage("hasLaunchedBefore")` to track first launch
- Full-screen modal on first launch
- Beautiful welcome message with:
  - App name and logo
  - Brief description of three-column layout
  - Overview of Projects, Documents, and Tags
  - "Don't show this again" checkbox
  - "Get Started" button to dismiss

**UI Design:**
- Platform-specific layouts (Mac: larger, iOS: compact)
- Visual diagram showing the three columns
- Optional: Interactive tour (swipe through features)

**Files to Create:**
- `Views/Onboarding/WelcomeSplashView.swift` - Main splash screen
- `Views/Onboarding/FeatureTourView.swift` (optional) - Multi-page tour

**Files to Modify:**
- `Markdown_EditorApp.swift` - Show splash on first launch
- `Views/Main/ContentView.swift` - Present splash as modal

---

### 2.2 Sample Document

**Goal:** Create a helpful sample document on first launch to demonstrate features.

**Content Ideas:**
- Welcome message
- Markdown syntax cheatsheet
- Examples of headers, lists, code blocks, tables
- Task list examples
- Link to documentation

**Implementation:**
- Check if database is empty on launch
- If empty, create sample document with pre-written content
- Assign to "Getting Started" project
- Tag with "Welcome"

**Files to Modify:**
- `Markdown_EditorApp.swift` - Add first launch document creation
- Create `Resources/SampleDocument.md` - Sample content

---

## 3. Settings/Preferences Screen

### 3.1 Settings UI

**Goal:** User preferences screen accessible via menu or toolbar.

**Navigation:**
- macOS: Settings in app menu (⌘,)
- iOS/iPadOS: Settings button in sidebar or toolbar

**Settings Categories:**

#### Editor Settings
- **Font Family**: System, Monospace, Custom
- **Font Size**: Slider (10-24pt)
- **Theme**: Light, Dark, System

#### Preview Settings
- **Preview Font Size**: Slider (10-24pt)
- **Preview Position**: Left, Right, Bottom, Detached
- **Syntax Highlighting Theme**: GitHub Light, GitHub Dark, Auto

#### Export Settings (macOS only)
- **Default Export Location**: File picker
- **PDF Page Size**: Letter, A4, Custom
- **Include Metadata**: Toggle

#### Sync Settings
- **CloudKit Status**: Display sync status
- **Last Sync Time**: Read-only display
- **Sync Enabled**: Toggle (disable/enable iCloud sync)
- **Refresh Sync**: Manual sync trigger button

#### About
- **App Name**: Mac MD
- **Version**: Display current version
- **Build Number**: Display build
- **Credits**: Links to inspirations (MacDown, Stewart Lynch, etc.)
- **GitHub Link**: Repository URL
- **Privacy Policy**: Link (for App Store compliance)

**Files to Create:**
- `Views/Settings/SettingsView.swift` - Main settings container
- `Views/Settings/EditorSettingsView.swift` - Editor preferences
- `Views/Settings/PreviewSettingsView.swift` - Preview preferences
- `Views/Settings/ExportSettingsView.swift` - Export preferences (Mac only)
- `Views/Settings/SyncSettingsView.swift` - CloudKit sync status
- `Views/Settings/AboutView.swift` - Credits and version info
- `Utilities/AppSettings.swift` - @AppStorage wrapper for preferences

**Files to Modify:**
- `Utilities/AppCommands.swift` - Add Settings command (⌘,)
- `Views/Main/ContentView.swift` - Present settings sheet

---

### 3.2 Settings Persistence

**Implementation:**
- Use `@AppStorage` for simple preferences
- Create `AppSettings` class with published properties
- Settings sync automatically via `@AppStorage` (UserDefaults + iCloud sync)

**Settings Keys:**
```swift
// Example structure
@AppStorage("editorFontFamily") var editorFontFamily: String = "System"
@AppStorage("editorFontSize") var editorFontSize: Double = 14.0
@AppStorage("previewFontSize") var previewFontSize: Double = 14.0
@AppStorage("defaultExportPath") var defaultExportPath: String = ""
@AppStorage("pdfPageSize") var pdfPageSize: String = "Letter"
```

---

## 4. App Icon & Branding

### 4.1 App Icon Design

**Requirements:**
- **Master Size**: 1024x1024 PNG (no alpha channel)
- **Style**: Modern, clean, recognizable
- **Theme**: Markdown-related (e.g., "M" letter, down arrow, document)
- **Colors**: Should look good in both light and dark modes

**Design Options:**
1. **Option A**: Stylized "M" with down arrow (MacDown homage)
2. **Option B**: Document with Markdown "M"
3. **Option C**: Modern geometric "MD" monogram

**Asset Sizes Required:**
- macOS: 16x16, 32x32, 64x64, 128x128, 256x256, 512x512, 1024x1024 (@1x and @2x)
- iOS: 20x20, 29x29, 40x40, 60x60, 76x76, 83.5x83.5, 1024x1024 (@2x and @3x)

**Files to Create/Modify:**
- `Assets.xcassets/AppIcon.appiconset/` - All icon sizes
- Export from design tool (Figma, Sketch, etc.) to PNG

---

### 4.2 Launch Screen

**Requirements:**
- Simple, branded launch screen
- Displays while app loads
- No marketing copy (App Store guidelines)

**Design:**
- App icon centered
- App name below icon
- Solid background color matching brand

**Files to Modify:**
- `Assets.xcassets/LaunchScreen.imageset/` - Launch screen assets

---

### 4.3 App Store Marketing Assets

**Requirements (for v1.0, prepare in v0.4.0):**
- **Screenshots**:
  - iPhone (6.5", 5.5")
  - iPad Pro (12.9", 11")
  - Mac (1280x800 minimum)
- **Preview Video**: 30 seconds, portrait and landscape
- **App Description**: Compelling copy highlighting features

**Preparation:**
- Take screenshots of best features (three-column layout, live preview, export)
- Record screen capture for preview video
- Draft App Store description text

**Files to Create:**
- `docs/app-store/screenshots/` - Organized screenshot directory
- `docs/app-store/description.md` - App Store copy draft

---

## 5. Quality Assurance

### 5.1 CloudKit Sync Verification

**Goal:** Ensure CloudKit sync works reliably across devices.

**Testing Checklist:**
- [ ] Create document on Mac, verify appears on iPad
- [ ] Edit document on iPad, verify changes sync to Mac
- [ ] Delete document on iPhone, verify deleted on all devices
- [ ] Create project on Mac, verify appears on iPad
- [ ] Add tag on iPad, verify appears on iPhone
- [ ] Test with airplane mode (offline changes, then sync when online)
- [ ] Test sync status display in Settings
- [ ] Test manual sync trigger button

**Known Issues to Address:**
- CloudKit sync delays (expected, document)
- Conflict resolution (last-write-wins? merge?)
- Large document sync performance

**Files to Modify:**
- `Markdown_EditorApp.swift` - Verify CloudKit configuration
- `Views/Settings/SyncSettingsView.swift` - Display sync status accurately

---

### 5.2 Cross-Platform Testing

**Testing Matrix:**
| Feature | Mac | iPad (landscape) | iPad (portrait) | iPhone |
|---------|-----|------------------|-----------------|--------|
| Three-column layout | ✓ | ✓ | ✓ (2-col) | ✓ (stack) |
| Document CRUD | ✓ | ✓ | ✓ | ✓ |
| Multi-select | ✓ | ✓ | ✓ | ✓ |
| Bulk operations | ✓ | ✓ | ✓ | ✓ |
| Settings screen | ✓ | ✓ | ✓ | ✓ |
| Splash screen | ✓ | ✓ | ✓ | ✓ |
| Export (PDF) | ✓ | ✓ | ✓ | ✓ |
| Export (HTML) | ✓ | ✗ (bug) | ✗ (bug) | ✗ (bug) |
| Keyboard shortcuts | ✓ | ✓ (ext kbd) | ✓ (ext kbd) | N/A |

**Test Scenarios:**
- Rotate iPad while using app (layout adapts correctly?)
- iPhone portrait vs landscape (readable?)
- Split View on iPad (works properly?)
- Dark Mode vs Light Mode (all colors correct?)
- Dynamic Type (accessibility font sizes)
- VoiceOver (accessibility testing)

---

### 5.3 Performance Testing

**Goal:** Ensure app performs well with large document collections.

**Test Cases:**
- [ ] Create 100 documents, measure list scroll performance
- [ ] Create 1000 documents, measure app launch time
- [ ] Edit document with 10,000 words, measure typing lag
- [ ] Export 100 documents to PDF, measure time
- [ ] Tag 50 documents at once, measure operation time

**Performance Targets:**
- List scroll: 60fps consistently
- App launch: < 2 seconds
- Typing lag: Imperceptible (< 16ms per keystroke)
- Bulk operations: < 5 seconds for 50 items

**Profiling Tools:**
- Xcode Instruments: Time Profiler
- Xcode Instruments: Allocations
- Xcode Instruments: Leaks

---

### 5.4 Memory Leak Detection

**Goal:** Zero memory leaks before v1.0 launch.

**Testing Process:**
1. Run app with Instruments (Leaks template)
2. Exercise all features (create, edit, delete, export)
3. Check for retain cycles in closures
4. Verify `@Bindable`, `@State`, `@Environment` usage

**Common Leak Sources:**
- Strong reference cycles in closures (use `[weak self]`)
- SwiftData context not released
- WKWebView not properly deallocated
- Timer or notification observers not removed

---

## Implementation Checklist

### Phase 1: Organizational Features (Week 1)
- [ ] Multi-select documents (Cmd/Ctrl-Click)
- [ ] Bulk delete with confirmation
- [ ] Bulk tag application
- [ ] Bulk move to project
- [ ] Context menu for bulk operations

### Phase 2: First Launch Experience (Week 1)
- [ ] Welcome splash screen UI
- [ ] First launch detection (`@AppStorage`)
- [ ] Sample document creation
- [ ] "Don't show again" preference

### Phase 3: Settings Screen (Week 2)
- [ ] Settings navigation (⌘, on Mac)
- [ ] Editor settings (font family, size)
- [ ] Preview settings (font size, position)
- [ ] Export settings (Mac only, default location)
- [ ] CloudKit sync status display
- [ ] About section (version, credits, links)
- [ ] Settings persistence (`@AppStorage`)

### Phase 4: App Icon & Branding (Week 2-3)
- [ ] Design app icon (1024x1024 master)
- [ ] Generate all required asset sizes
- [ ] Create launch screen
- [ ] Prepare App Store screenshots
- [ ] Draft App Store description

### Phase 5: Quality Assurance (Week 3-4)
- [ ] CloudKit sync verification (Mac ↔ iPad ↔ iPhone)
- [ ] Cross-platform testing (all features, all devices)
- [ ] Performance testing (large document collections)
- [ ] Memory leak detection (Instruments)
- [ ] Accessibility audit (VoiceOver, Dynamic Type)

---

## Testing Plan

### Manual Testing
1. **Multi-Select & Bulk Operations**
   - Select 5 documents on Mac, bulk delete
   - Select 10 documents on iPad, bulk tag
   - Select 20 documents on iPhone, bulk move to project

2. **First Launch**
   - Delete app, reinstall, verify splash screen appears
   - Dismiss splash, verify sample document created
   - Relaunch app, verify splash does NOT appear

3. **Settings**
   - Change editor font size, verify updates immediately
   - Change preview position, verify preview moves
   - Toggle CloudKit sync, verify status updates
   - Change default export location (Mac), verify exports use it

4. **CloudKit Sync**
   - Create document on Mac, verify appears on iPad within 60 seconds
   - Edit on iPad, verify changes on Mac
   - Delete on iPhone, verify removed on all devices

5. **Performance**
   - Create 100 documents, scroll list (should be smooth)
   - Edit large document (5000 words), type quickly (no lag)

### Automated Testing
Consider adding UI tests for critical flows:
- [ ] First launch splash screen
- [ ] Multi-select and bulk delete
- [ ] Settings changes persist

---

## Files to Create

```
docs/
  v0.4.0_IMPLEMENTATION_PLAN.md (this file)
  app-store/
    screenshots/
      mac/
      ipad/
      iphone/
    description.md
    keywords.md

Resources/
  SampleDocument.md

Views/
  Onboarding/
    WelcomeSplashView.swift
    FeatureTourView.swift
  Settings/
    SettingsView.swift
    EditorSettingsView.swift
    PreviewSettingsView.swift
    ExportSettingsView.swift
    SyncSettingsView.swift
    AboutView.swift
  Components/
    BulkOperationsToolbar.swift
    TagPickerSheet.swift
    ProjectPickerSheet.swift
    DocumentRow.swift (if not exists)

Utilities/
  AppSettings.swift

Assets.xcassets/
  AppIcon.appiconset/
    (all required sizes)
  LaunchScreen.imageset/
    (launch screen assets)
```

---

## Files to Modify

```
Markdown_EditorApp.swift
  - First launch detection
  - Sample document creation
  - Settings command registration

Views/Main/
  ContentView.swift
    - Present splash screen on first launch
    - Present settings sheet
  DocumentListView.swift
    - Multi-select state
    - Bulk operations UI
    - Selection indicators
  SidebarView.swift
    - Settings button (iOS)

Utilities/
  AppCommands.swift
    - Add Settings command (⌘,)
```

---

## Success Criteria

v0.4.0 is complete when:
- ✅ Users can multi-select and bulk operate on documents
- ✅ First launch shows helpful splash screen
- ✅ Settings screen allows font and export customization
- ✅ CloudKit sync status is visible and accurate
- ✅ App icon looks professional on all platforms
- ✅ CloudKit sync verified across Mac, iPad, iPhone
- ✅ No memory leaks detected
- ✅ Performance targets met (60fps scrolling, < 2s launch)
- ✅ Cross-platform testing complete (all features work on all devices)

---

## Post-v0.4.0: Preparing for v1.0

After v0.4.0 is complete, v1.0 will focus on:
- Final visual polish and animations
- Marketing website (convert README to GitHub Pages)
- App Store submission materials finalized
- TestFlight beta testing (2+ weeks)
- App Store review and launch

Then, with v1.0 shipped and real user feedback, we tackle the ambitious v2.0 features:
- Snippets system
- Editor intelligence
- LaTeX/Math rendering
- macOS System Extension (text capture from any app)

---

**Ready to Ship:** The goal is to have v0.4.0 production-ready so v1.0 is just polish and marketing. Let's build it!
